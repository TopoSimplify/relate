package main

import (
	"github.com/intdxdt/geom"
	"fmt"
	"simplex/ctx"
	"simplex/relate"
)

func main(){
	var pwkt0 = "POLYGON (( 1035.4217232078936 1120.0023747810308, 1035.4217232078936 1123.7102438046654, 1039.4666712336768 1123.7102438046654, 1039.4666712336768 1120.0023747810308, 1035.4217232078936 1120.0023747810308 ))"
	var pwkt1 = "POLYGON (( 1055.1560716115728 1129.1741191258334, 1055.1560716115728 1132.2078301451709, 1059.706638140579 1132.2078301451709, 1059.706638140579 1129.1741191258334, 1055.1560716115728 1129.1741191258334 ))"
	var pwkt2 = "POLYGON (( 1029.3417054109004 1054.5286135053773, 1029.3417054109004 1056.2631998427164, 1031.0762917482396 1056.2631998427164, 1031.0762917482396 1054.5286135053773, 1029.3417054109004 1054.5286135053773 ))"
	var pwkt3 = "POLYGON (( 763.8425934899169 116.3660112818277, 763.8425934899169 124.00694984095215, 773.4645161199254 124.00694984095215, 773.4645161199254 116.3660112818277, 763.8425934899169 116.3660112818277 ))"
	var _,_, _, g3 = geom.ReadGeometry(pwkt0), geom.ReadGeometry(pwkt1), geom.ReadGeometry(pwkt2), geom.ReadGeometry(pwkt3)
	var contexts = ctx.NewContexts()
	//contexts.Push(ctx.New(g0, -1,0))
	//contexts.Push(ctx.New(g1, -1,0))
	contexts.Push(ctx.New(g3, -1,0))
	//var wkt = "LINESTRING ( 988.5677419092382 1133.8613508801056, 999.185730476919 1144.1422604456382, 1006.7700080252625 1143.6366419424153, 1009.6351795435257 1137.400680402666, 1008.118324033857 1126.6141523339109, 1015.1969830789776 1124.2545993188705, 1024.2981161369898 1123.5804413145734, 1033.399249195002 1113.299531749041, 1043.012087772414 1109.3369241873886, 1051.641915473869 1111.327826987455, 1054.8955309447945 1116.4406512989094, 1050.1390549944413 1124.3655289816638, 1034.4297464889285 1130.6887738691873, 1044.1857772637572 1140.6029309230778, 1052.6127523174723 1139.4231544155577, 1054.63775442288 1144.3145920854865, 1065.3989654048655 1144.9824131622377, 1073.0890223077179 1150.7150010352732, 1076.165045068859 1145.2620515950687, 1087.2107631656831 1144.5629555129913, 1091.5451588745636 1135.6145256623993, 1085.8125710015283 1126.805915028223, 1076.165045068859 1127.365191893885, 1074.495559277989 1135.6755658341485 )"
	//var wkt = "LINESTRING ( 1000 1180, 1004.4377870477083 1192.3811275270916, 1011.9880247341451 1198.3933538329582, 1025.1310310772021 1202.7277495418386, 1041.4898793978152 1200.630461295606, 1048.7604786514212 1191.2625737957676, 1052.8152359274707 1176.3019176393093, 1043.4473484276323 1167.493307005133, 1034.359099360625 1160.0828885351116, 1017.3011549579342 1164.2774650275765, 1005.8359792118632 1170.289691333443, 1000 1180 )"
	//var wkt  = "LINESTRING ( 980 1060, 990.6179885676809 1070.2809095655325, 998.2022661160244 1069.7752910623096, 1001.0674376342876 1063.5393295225604, 999.5505821246188 1052.7528014538052, 1006.6292411697394 1050.3932484387649, 1015.7303742277516 1049.7190904344677, 1024.8315072857638 1039.4381808689354, 1034.4443458631756 1035.475573307283, 1043.0741735646309 1037.4664761073493, 1046.3277890355564 1042.5793004188038, 1041.571313085203 1050.5041781015582, 1037.3838784294728 1064.1476831942578, 1038.8459997445448 1068.1517410761094, 1044.47991344586 1070.6129595425216, 1051.733638129278 1064.6207521953502, 1045.5837411150758 1056.4208895097472, 1034.2300850888562 1048.6940958252367, 1027.4494294065305 1049.0094751592983, 1020.668773724205 1055.790130841624, 1020.3533943901434 1069.509131873306, 1031.0762917482396 1077.8666842259397, 1056.148948806141 1075.3436495534465, 1060 1060 )"
	var wkt = "LINESTRING ( 681.773253410432 86.7361495358895, 696.09293826568 123.18625644015727, 708.4975697426287 142.11964132602637, 738.3727982928353 161.9286449121624, 774.8795047419856 163.0606358098105, 809.6882248446636 153.1557154553899, 827.2340837582086 125.42193846301224, 809.9712225690756 77.59532303738138, 791.7744688893829 62.00214842227923, 776.1529945018395 73.71825421293673, 802.6132817343632 124.28994756536417, 780.5394592302258 143.5337928253813, 752.8056822378483 135.0438610930208, 743.1837596078396 112.68704086447147, 755.7389547476799 97.99106646996367, 791.0868260219662 93.11549801833797, 822.6647028100804 93.0395669766998, 858.8166298025897 84.13257047129895 )"
	var ply = geom.NewLineStringFromWKT(wkt)
	var coords = reverseCoordinates(ply.Coordinates())
	var bln = relate.Homotopy(coords, contexts)
	fmt.Println(bln)
	//fmt.Println(ply.ConvexHull().WKT())
}


func reverseCoordinates(coordinates []*geom.Point) []*geom.Point {
	for i, j := 0, len(coordinates)-1; i < j; i, j = i+1, j-1 {
		coordinates[i], coordinates[j] = coordinates[j], coordinates[i]
	}
	return coordinates
}